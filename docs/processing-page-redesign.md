# Processing Page Redesign - 단일 영상 포커스 워크플로우

## 개요

Processing 페이지를 "비디오 라이브러리" 형태에서 **단일 영상 중심 워크플로우**로 재설계합니다.

### 핵심 개념
- **하나의 영상**을 중심으로 한 워크플로우
- 4가지 상태 기반 화면 전환 (기존 5개에서 4개로 통합)
- 비디오 라이브러리가 아닌 **현재 세션의 영상 처리**에 집중

### 사용자 흐름
```
Effects 페이지 → "생성하기" 클릭
       ↓
[State 1: GENERATING] 영상 생성 중...
       ↓ (생성 완료)
[State 2: READY] 분기점 - "바로 배포" vs "베리에이션"
       ↓ (베리에이션 선택 시)
[State 3: VARIATION_CONFIG] 스타일 선택 + 생성 진행 (통합)
       ↓ (생성 완료)
[State 4: COMPARE_AND_APPROVE] 비교 및 최종 선택
       ↓
배포 페이지로 이동
```

---

## State 1: GENERATING (영상 생성 중)

Effects 페이지에서 "생성하기" 클릭 후 첫 진입 화면

### 레이아웃

```
┌─────────────────────────────────────────────────────────────────┐
│  Fast Cut                              영상 생성 중...          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────────────┐  ┌─────────────────────────────┐│
│  │                           │  │  📋 콘텐츠 요약              ││
│  │                           │  │                             ││
│  │      ┌─────────────┐      │  │  📝 스크립트                 ││
│  │      │             │      │  │  "오늘 소개할 신제품은..."    ││
│  │      │   [9:16]    │      │  │                             ││
│  │      │             │      │  │  🖼️ 이미지                  ││
│  │      │    🔄       │      │  │  5장 선택됨                  ││
│  │      │   67%       │      │  │  [썸네일] [썸네일] [+3]      ││
│  │      │             │      │  │                             ││
│  │      └─────────────┘      │  │  🎵 음악                    ││
│  │                           │  │  Upbeat Pop - 0:24          ││
│  │      ━━━━━━━━━━━━━━━      │  │                             ││
│  │      프레임 합성 중...      │  │  ⚡ 이펙트                  ││
│  │      예상 시간: 1분 32초    │  │  Zoom Pulse + Glitch        ││
│  │                           │  │                             ││
│  └───────────────────────────┘  └─────────────────────────────┘│
│                                                                 │
│            💡 생성이 완료되면 바로 확인할 수 있습니다              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 구성요소

**좌측 60%: 영상 프리뷰 영역**
- 9:16 비율 프레임 (검정 배경)
- 중앙에 원형 프로그레스 표시 (67% 등)
- 프로그레스 바 아래 현재 단계 텍스트 (프레임 합성 중...)
- 예상 남은 시간 표시

**우측 40%: 콘텐츠 요약 카드**
- 스크립트 미리보기 (첫 줄 또는 요약)
- 선택된 이미지 썸네일 (최대 3개 + 나머지 개수)
- 음악 정보 (제목, 길이)
- 적용된 이펙트 프리셋 이름

### 상태 전환
- 생성 완료 (100%) → 자동으로 State 2 (READY)로 전환

---

## State 2: READY (분기점 - 결정 화면)

영상 생성 완료 후 자동 전환되는 **핵심 결정 화면**

### 레이아웃

```
┌─────────────────────────────────────────────────────────────────┐
│  Fast Cut                              ✓ 영상 완성!             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────┐  ┌───────────────────────────────────┐│
│  │                     │  │                                   ││
│  │   ┌─────────────┐   │  │  다음 단계를 선택하세요            ││
│  │   │             │   │  │                                   ││
│  │   │   완성된    │   │  │  ┌─────────────────────────────┐  ││
│  │   │    영상     │   │  │  │  🚀 바로 배포하기            │  ││
│  │   │   [9:16]    │   │  │  │                             │  ││
│  │   │             │   │  │  │  이 영상을 바로 배포합니다    │  ││
│  │   │    ▶       │   │  │  │  → 플랫폼 선택으로 이동       │  ││
│  │   └─────────────┘   │  │  └─────────────────────────────┘  ││
│  │                     │  │                                   ││
│  │   🔊 ━━━━━━━━━━━━   │  │  ┌─────────────────────────────┐  ││
│  │   0:24 / 0:24       │  │  │  🎨 베리에이션 만들기         │  ││
│  │                     │  │  │                             │  ││
│  │  [⬇️ 다운로드]       │  │  │  8가지 스타일로 다양한 버전   │  ││
│  │                     │  │  │  생성 후 비교하여 선택        │  ││
│  └─────────────────────┘  │  └─────────────────────────────┘  ││
│                           │                                   ││
│                           └───────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
```

### 구성요소

**좌측 45%: 완성된 영상 플레이어**
- 9:16 비율 비디오 플레이어
- 풀 컨트롤 (재생/일시정지, 볼륨, 시크바)
- 현재 시간 / 총 시간 표시
- 다운로드 버튼

**우측 55%: 두 개의 대형 선택 카드**

1. **🚀 바로 배포하기** (상단 카드)
   - 강조 스타일 (primary color border)
   - 설명: "이 영상을 바로 배포합니다"
   - 부가 설명: "→ 플랫폼 선택으로 이동"
   - 클릭 → Publish 페이지로 이동 (원본 영상 1개 전달)

2. **🎨 베리에이션 만들기** (하단 카드)
   - 일반 스타일 (neutral border)
   - 설명: "8가지 스타일로 다양한 버전 생성"
   - 부가 설명: "비교 후 최적의 영상 선택"
   - 클릭 → State 3 (VARIATION_CONFIG)으로 전환

### 상태 전환
- "바로 배포하기" 클릭 → Publish 페이지로 라우팅
- "베리에이션 만들기" 클릭 → State 3으로 전환

---

## State 3: VARIATION_CONFIG (베리에이션 설정 + 생성)

**변경사항**: 기존 설계에서 State 3과 State 4를 통합
- 스타일 선택 UI
- "시작하기" 클릭 시 **같은 화면 하단**에 생성 진행 상황 표시
- 별도 화면 전환 없이 진행 상황 실시간 확인

### 레이아웃 (생성 전)

```
┌─────────────────────────────────────────────────────────────────┐
│  ← 돌아가기               베리에이션 설정             [시작하기 →]│
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌────────────┐  ┌─────────────────────────────────────────────┐│
│  │            │  │  📦 생성할 스타일 선택 (1-8개)               ││
│  │  ┌──────┐  │  │                                             ││
│  │  │ 원본 │  │  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌────┐││
│  │  │ 영상 │  │  │  │ ✓ Viral │ │□ Cinema │ │□ Clean  │ │□ En│││
│  │  │      │  │  │  │  TikTok │ │   Mood  │ │ Minimal │ │Beat│││
│  │  │  ▶   │  │  │  └─────────┘ └─────────┘ └─────────┘ └────┘││
│  │  └──────┘  │  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌────┐││
│  │            │  │  │□ Retro  │ │□ Prof   │ │□ Dreamy │ │□ Bo│││
│  │  콘텐츠:   │  │  │Aesthetic│ │  Corp   │ │  Soft   │ │Impa│││
│  │  📝 스크립트│  │  └─────────┘ └─────────┘ └─────────┘ └────┘││
│  │  🖼️ 5장    │  │                                             ││
│  │  🎵 음악   │  │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ ││
│  │  ⚡ 이펙트 │  │  선택됨: 1개  │  예상 생성 시간: ~2분         ││
│  └────────────┘  │                                             ││
│                  │  💡 3-5개 스타일 선택 시 효과적인 A/B 테스트   ││
│                  └─────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
```

### 레이아웃 (생성 중) - 하단에 진행 상황 추가

```
┌─────────────────────────────────────────────────────────────────┐
│  ← 돌아가기               베리에이션 생성 중           [취소]    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌────────────┐  ┌─────────────────────────────────────────────┐│
│  │  원본 영상  │  │  📦 선택된 스타일 (3개)                      ││
│  │  [작은 뷰]  │  │  ✓ Viral TikTok  ✓ Cinematic  ✓ Clean      ││
│  └────────────┘  └─────────────────────────────────────────────┘│
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  🔄 생성 진행 상황                     전체: 2/3 완료        ││
│  │                                                             ││
│  │  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐   ││
│  │  │  ⭐ 원본  │ │   Viral   │ │ Cinematic │ │   Clean   │   ││
│  │  │           │ │  TikTok   │ │   Mood    │ │  Minimal  │   ││
│  │  │  ┌─────┐  │ │  ┌─────┐  │ │  ┌─────┐  │ │  ┌─────┐  │   ││
│  │  │  │  ✓  │  │ │  │  ✓  │  │ │  │ 67% │  │ │  │ 23% │  │   ││
│  │  │  └─────┘  │ │  └─────┘  │ │  └─────┘  │ │  └─────┘  │   ││
│  │  │  완료됨   │ │  완료됨   │ │ 렌더링중  │ │ 이펙트중  │   ││
│  │  └───────────┘ └───────────┘ └───────────┘ └───────────┘   ││
│  │                                                             ││
│  │  💡 완료 시 자동으로 비교 화면으로 이동합니다                  ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
```

### 구성요소

**상단 영역 (설정 요약)**
- 좌측: 원본 영상 작은 미리보기
- 우측: 선택된 스타일 태그 표시

**하단 영역 (생성 진행) - "시작하기" 클릭 후 나타남**
- 전체 진행 상황 (2/3 완료)
- 카드 그리드:
  - 원본: 항상 ✓ 완료 표시
  - 각 베리에이션: 진행률 % 또는 ✓ 완료
  - 현재 단계 텍스트 (렌더링중, 이펙트중 등)

### 8가지 스타일 정보

| ID | 이름 | 설명 |
|----|------|------|
| viral_tiktok | Viral TikTok | 빠른 컷, 트렌디 트랜지션, 화면 전환 효과 |
| cinematic_mood | Cinematic Mood | 시네마틱 색감, 슬로우 페이드, 영화적 분위기 |
| clean_minimal | Clean Minimal | 심플한 구성, 화이트 스페이스, 미니멀 디자인 |
| energetic_beat | Energetic Beat | 비트 싱크, 다이나믹 모션, 에너지 넘치는 효과 |
| retro_aesthetic | Retro Aesthetic | 빈티지 필터, 노이즈 효과, 레트로 감성 |
| professional_corp | Professional Corp | 깔끔한 기업 스타일, 전문적인 느낌 |
| dreamy_soft | Dreamy Soft | 소프트 블러, 파스텔 톤, 몽환적 분위기 |
| bold_impact | Bold Impact | 강렬한 텍스트, 하이 컨트라스트, 임팩트 있는 효과 |

### 상태 전환
- "시작하기" 클릭 → 같은 화면에서 하단 생성 진행 섹션 표시
- 모든 생성 완료 → 자동으로 State 4 (COMPARE_AND_APPROVE)로 전환
- "취소" 클릭 → 생성 중단, State 2 (READY)로 복귀

---

## State 4: COMPARE_AND_APPROVE (비교 및 승인)

최종 결정 화면 - 원본 + 모든 베리에이션을 나란히 비교

### 레이아웃

```
┌─────────────────────────────────────────────────────────────────┐
│  ← 설정으로       비교 및 최종 선택        승인: 0/4  [배포하기 →]│
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │ ⭐ 원본  │ │  Viral   │ │ Cinema   │ │  Clean   │           │
│  │          │ │  TikTok  │ │   Mood   │ │ Minimal  │           │
│  │ ┌──────┐ │ │ ┌──────┐ │ │ ┌──────┐ │ │ ┌──────┐ │           │
│  │ │      │ │ │ │      │ │ │ │      │ │ │ │      │ │           │
│  │ │[9:16]│ │ │ │[9:16]│ │ │ │[9:16]│ │ │ │[9:16]│ │           │
│  │ │  ▶   │ │ │ │  ▶   │ │ │ │  ▶   │ │ │ │  ▶   │ │           │
│  │ └──────┘ │ │ └──────┘ │ │ └──────┘ │ │ └──────┘ │           │
│  │          │ │          │ │          │ │          │           │
│  │ [✓] [✗]  │ │ [✓] [✗]  │ │ [✓] [✗]  │ │ [✓] [✗]  │           │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘           │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  🎬 동기화 재생                                                  │
│    [▶ 재생]  🔊  0:12/0:24  ━━━━━━●━━━━━━━━━                    │
│                                                                 │
│  [모두 승인]  [모두 거부]  │  승인된 영상만 배포됩니다             │
└─────────────────────────────────────────────────────────────────┘
```

### 구성요소

**헤더**
- "← 설정으로" 버튼 (State 3으로 복귀, 추가 베리에이션 생성 가능)
- 승인 카운터 (X/Y approved)
- "배포하기" CTA 버튼 (최소 1개 승인 시 활성화)

**비디오 그리드** (가로 스크롤 가능)
- 각 카드:
  - 스타일 라벨 (원본은 ⭐ 뱃지)
  - 9:16 비디오 플레이어 (동기화 재생)
  - 승인 ✓ / 거부 ✗ 버튼
- 승인된 카드: 녹색 테두리 + 체크 아이콘
- 거부된 카드: 흐리게 처리 + 음영

**동기화 재생 컨트롤**
- 마스터 재생/일시정지 버튼
- 볼륨 컨트롤
- 시크바 (모든 영상 동시 제어)
- 현재 시간 / 총 시간

**하단 벌크 액션**
- "모두 승인" 버튼
- "모두 거부" 버튼
- 안내 텍스트: "승인된 영상만 배포됩니다"

### 승인 상태

| 상태 | 시각적 표시 |
|------|------------|
| Pending (기본) | 테두리 없음, 일반 표시 |
| Approved (✓) | 녹색 테두리, 체크 아이콘 |
| Rejected (✗) | 흐리게 처리, X 아이콘 |

### 상태 전환
- "배포하기" 클릭 → Publish 페이지로 이동 (승인된 영상들만 전달)
- "← 설정으로" 클릭 → State 3으로 복귀 (추가 스타일 선택 가능)

---

## 데이터 구조

### ProcessingSession Interface

```typescript
type ProcessingState =
  | 'GENERATING'           // 원본 영상 생성 중
  | 'READY'                // 분기점 - 배포 vs 베리에이션
  | 'VARIATION_CONFIG'     // 스타일 선택 + 생성 진행
  | 'COMPARE_AND_APPROVE'; // 비교 및 최종 선택

interface ProcessingSession {
  id: string;
  state: ProcessingState;
  createdAt: Date;

  // 원본 영상 정보
  originalVideo: {
    id: string;
    status: 'generating' | 'completed' | 'failed';
    progress: number;        // 0-100
    currentStep?: string;    // "프레임 합성 중", "이펙트 적용 중" 등
    outputUrl?: string;
    thumbnailUrl?: string;
  };

  // 콘텐츠 정보 (Fast Cut에서 전달)
  content: {
    script: string;
    images: Array<{
      id: string;
      url: string;
      thumbnailUrl: string;
    }>;
    musicTrack: {
      id: string;
      name: string;
      duration: number;
      url: string;
    };
    effectPreset: {
      id: string;
      name: string;
      description: string;
    };
  };

  // 베리에이션 설정 (State 3에서 설정)
  variationConfig: {
    selectedStyles: string[];  // style IDs
    isGenerating: boolean;
  };

  // 생성된 베리에이션들
  variations: Array<{
    id: string;
    styleId: string;
    styleName: string;
    status: 'pending' | 'generating' | 'completed' | 'failed';
    progress: number;
    currentStep?: string;
    outputUrl?: string;
    thumbnailUrl?: string;
    approved: boolean | null;  // null = pending, true = approved, false = rejected
  }>;
}
```

### Style Set Type

```typescript
interface StyleSet {
  id: string;
  name: string;
  nameKo: string;
  description: string;
  descriptionKo: string;
  icon: string;           // Lucide icon name
  previewImage?: string;  // 스타일 미리보기 이미지
  effectConfig: {
    // 각 스타일별 이펙트 설정
    transitions: string[];
    filters: string[];
    textStyles: object;
    // ...
  };
}

const STYLE_SETS: StyleSet[] = [
  {
    id: 'viral_tiktok',
    name: 'Viral TikTok',
    nameKo: '바이럴 틱톡',
    description: 'Fast cuts, trendy transitions',
    descriptionKo: '빠른 컷, 트렌디한 트랜지션',
    icon: 'Zap',
    // ...
  },
  // ... 나머지 7개 스타일
];
```

---

## 구현 계획

### 파일 구조

```
components/features/processing/
├── ProcessingPage.tsx           # 메인 페이지 (상태 라우터)
├── views/
│   ├── GeneratingView.tsx       # State 1: 생성 중
│   ├── ReadyView.tsx            # State 2: 분기점
│   ├── VariationConfigView.tsx  # State 3: 설정 + 생성
│   └── CompareApproveView.tsx   # State 4: 비교 및 승인
├── components/
│   ├── VideoPreview.tsx         # 영상 프리뷰 컴포넌트
│   ├── ContentSummary.tsx       # 콘텐츠 요약 카드
│   ├── StyleSelector.tsx        # 스타일 선택 그리드
│   ├── GenerationProgress.tsx   # 생성 진행 카드
│   └── SyncedVideoPlayer.tsx    # 동기화 비디오 플레이어
└── hooks/
    └── useProcessingSession.ts  # 세션 상태 관리 훅
```

### 구현 순서

1. **ProcessingSession 타입 및 스토어 정의**
   - `lib/stores/processing-session-store.ts` 생성
   - Zustand 스토어로 세션 상태 관리

2. **State 1: GeneratingView 구현**
   - 프로그레스 UI
   - 콘텐츠 요약 표시

3. **State 2: ReadyView 구현**
   - 비디오 플레이어
   - 두 개의 선택 카드

4. **State 3: VariationConfigView 구현**
   - 스타일 선택 그리드
   - 생성 진행 섹션 (동적 표시)

5. **State 4: CompareApproveView 구현**
   - 동기화 비디오 플레이어 (기존 ComparePanel 활용)
   - 승인/거부 UI

6. **라우팅 및 통합**
   - Effects → Processing 연결
   - Processing → Publish 연결

---

## 기존 코드와의 관계

### 유지할 컴포넌트
- `ComparePanel.tsx` - State 4에서 재사용/참고 가능
- `VariationPanel.tsx` - 스타일 정보 및 일부 UI 참고

### 대체될 컴포넌트
- 기존 `processing/page.tsx`의 리스트 기반 UI → 새로운 상태 기반 UI로 대체

### 통합 필요 사항
- Fast Cut workflow와의 연결 (Effects → Processing 전환)
- 배포 flow와의 연결 (Processing → Publish 전환)
- 기존 workflow-store의 영상 데이터 활용

---

## 변경 이력

| 날짜 | 변경 내용 |
|------|----------|
| 2024-XX-XX | 초기 설계 - 5개 상태 구조 |
| 2024-XX-XX | State 3, 4 통합 - VARIATION_CONFIG에서 생성 진행도 표시 |
